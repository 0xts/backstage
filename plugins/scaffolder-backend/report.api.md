## API Report File for "@backstage/plugin-scaffolder-backend"

> Do not edit this file. It is a report generated by [API Extractor](https://api-extractor.com/).

```ts
import { AuditorService } from '@backstage/backend-plugin-api';
import { AuthService } from '@backstage/backend-plugin-api';
import { BackendFeature } from '@backstage/backend-plugin-api';
import { BackstageCredentials } from '@backstage/backend-plugin-api';
import { CatalogApi } from '@backstage/catalog-client';
import { Config } from '@backstage/config';
import { DatabaseService } from '@backstage/backend-plugin-api';
import { Duration } from 'luxon';
import { EventsService } from '@backstage/plugin-events-node';
import { HumanDuration } from '@backstage/types';
import { JsonObject } from '@backstage/types';
import { JsonValue } from '@backstage/types';
import { Knex } from 'knex';
import { Logger } from 'winston';
import { PermissionEvaluator } from '@backstage/plugin-permission-common';
import { PermissionRule } from '@backstage/plugin-permission-node';
import { PermissionRuleParams } from '@backstage/plugin-permission-common';
import { RESOURCE_TYPE_SCAFFOLDER_ACTION } from '@backstage/plugin-scaffolder-common/alpha';
import { RESOURCE_TYPE_SCAFFOLDER_TEMPLATE } from '@backstage/plugin-scaffolder-common/alpha';
import { ScmIntegrations } from '@backstage/integration';
import { SerializedTask as SerializedTask_2 } from '@backstage/plugin-scaffolder-node';
import { SerializedTaskEvent as SerializedTaskEvent_2 } from '@backstage/plugin-scaffolder-node';
import { TaskBroker as TaskBroker_2 } from '@backstage/plugin-scaffolder-node';
import { TaskBrokerDispatchOptions as TaskBrokerDispatchOptions_2 } from '@backstage/plugin-scaffolder-node';
import { TaskBrokerDispatchResult as TaskBrokerDispatchResult_2 } from '@backstage/plugin-scaffolder-node';
import { TaskCompletionState as TaskCompletionState_2 } from '@backstage/plugin-scaffolder-node';
import { TaskContext as TaskContext_2 } from '@backstage/plugin-scaffolder-node';
import { TaskEventType as TaskEventType_2 } from '@backstage/plugin-scaffolder-node';
import { TaskRecovery } from '@backstage/plugin-scaffolder-common';
import { TaskSecrets } from '@backstage/plugin-scaffolder-node';
import { TaskSpec } from '@backstage/plugin-scaffolder-common';
import { TaskSpecV1beta3 } from '@backstage/plugin-scaffolder-common';
import { TaskStatus as TaskStatus_2 } from '@backstage/plugin-scaffolder-node';
import { TemplateAction } from '@backstage/plugin-scaffolder-node';
import { TemplateEntityStepV1beta3 } from '@backstage/plugin-scaffolder-common';
import { TemplateFilter as TemplateFilter_2 } from '@backstage/plugin-scaffolder-node';
import { TemplateGlobal as TemplateGlobal_2 } from '@backstage/plugin-scaffolder-node';
import { TemplateParametersV1beta3 } from '@backstage/plugin-scaffolder-common';
import { UrlReaderService } from '@backstage/backend-plugin-api';
import { WorkspaceProvider } from '@backstage/plugin-scaffolder-node/alpha';

// @public (undocumented)
export type ActionPermissionRuleInput<
  TParams extends PermissionRuleParams = PermissionRuleParams,
> = PermissionRule<
  TemplateEntityStepV1beta3 | TemplateParametersV1beta3,
  {},
  typeof RESOURCE_TYPE_SCAFFOLDER_ACTION,
  TParams
>;

// @public
export const createBuiltinActions: (
  options: CreateBuiltInActionsOptions,
) => TemplateAction[];

// @public
export interface CreateBuiltInActionsOptions {
  additionalTemplateFilters?: Record<string, TemplateFilter_2>;
  // (undocumented)
  additionalTemplateGlobals?: Record<string, TemplateGlobal_2>;
  auth?: AuthService;
  catalogClient: CatalogApi;
  config: Config;
  integrations: ScmIntegrations;
  reader: UrlReaderService;
}

// @public
export function createCatalogRegisterAction(options: {
  catalogClient: CatalogApi;
  integrations: ScmIntegrations;
  auth?: AuthService;
}): TemplateAction<
  | {
      catalogInfoUrl: string;
      optional?: boolean;
    }
  | {
      repoContentsUrl: string;
      catalogInfoPath?: string;
      optional?: boolean;
    },
  JsonObject,
  'v1'
>;

// @public
export function createCatalogWriteAction(): TemplateAction<
  {
    entity: Record<string, any>;
    filePath?: string | undefined;
  },
  any,
  'v1'
>;

// @public
export function createDebugLogAction(): TemplateAction<any, any, 'v1'>;

// @public
export function createFetchCatalogEntityAction(options: {
  catalogClient: CatalogApi;
  auth?: AuthService;
}): TemplateAction<
  {
    entityRef?: string | undefined;
    entityRefs?: string[] | undefined;
    optional?: boolean | undefined;
    defaultKind?: string | undefined;
    defaultNamespace?: string | undefined;
  },
  {
    entity?: any;
    entities?: any[] | undefined;
  },
  'v2'
>;

// @public
export function createFetchPlainAction(options: {
  reader: UrlReaderService;
  integrations: ScmIntegrations;
}): TemplateAction<
  {
    url: string;
    targetPath?: string;
    token?: string;
  },
  JsonObject,
  'v1'
>;

// @public
export function createFetchPlainFileAction(options: {
  reader: UrlReaderService;
  integrations: ScmIntegrations;
}): TemplateAction<
  {
    url: string;
    targetPath: string;
    token?: string;
  },
  JsonObject,
  'v1'
>;

// @public
export function createFetchTemplateAction(options: {
  reader: UrlReaderService;
  integrations: ScmIntegrations;
  additionalTemplateFilters?: Record<string, TemplateFilter_2>;
  additionalTemplateGlobals?: Record<string, TemplateGlobal_2>;
}): TemplateAction<
  {
    url: string;
    targetPath?: string;
    values: any;
    templateFileExtension?: string | boolean;
    copyWithoutRender?: string[];
    copyWithoutTemplating?: string[];
    cookiecutterCompat?: boolean;
    replace?: boolean;
    trimBlocks?: boolean;
    lstripBlocks?: boolean;
    token?: string;
  },
  JsonObject,
  'v1'
>;

// @public
export function createFetchTemplateFileAction(options: {
  reader: UrlReaderService;
  integrations: ScmIntegrations;
  additionalTemplateFilters?: Record<string, TemplateFilter_2>;
  additionalTemplateGlobals?: Record<string, TemplateGlobal_2>;
}): TemplateAction<
  {
    url: string;
    targetPath: string;
    values: any;
    cookiecutterCompat?: boolean;
    replace?: boolean;
    trimBlocks?: boolean;
    lstripBlocks?: boolean;
    token?: string;
  },
  JsonObject,
  'v1'
>;

// @public
export const createFilesystemDeleteAction: () => TemplateAction<
  {
    files: string[];
  },
  JsonObject,
  'v1'
>;

// @public
export const createFilesystemReadDirAction: () => TemplateAction<
  {
    recursive: boolean;
    paths: string[];
  },
  {
    files: {
      name: string;
      path: string;
      fullPath: string;
    }[];
    folders: {
      name: string;
      path: string;
      fullPath: string;
    }[];
  },
  'v1'
>;

// @public
export const createFilesystemRenameAction: () => TemplateAction<
  {
    files: Array<{
      from: string;
      to: string;
      overwrite?: boolean;
    }>;
  },
  JsonObject,
  'v1'
>;

// @public
export function createWaitAction(options?: {
  maxWaitTime?: Duration | HumanDuration;
}): TemplateAction<HumanDuration, JsonObject, 'v1'>;

// @public
export type CreateWorkerOptions = {
  taskBroker: TaskBroker_2;
  actionRegistry: TemplateActionRegistry;
  integrations: ScmIntegrations;
  workingDirectory: string;
  logger: Logger;
  auditor?: AuditorService;
  additionalTemplateFilters?: Record<string, TemplateFilter_2>;
  concurrentTasksLimit?: number;
  additionalTemplateGlobals?: Record<string, TemplateGlobal_2>;
  permissions?: PermissionEvaluator;
  gracefulShutdown?: boolean;
};

// @public
export interface CurrentClaimedTask {
  createdBy?: string;
  secrets?: TaskSecrets;
  spec: TaskSpec;
  state?: JsonObject;
  taskId: string;
  workspace?: Promise<Buffer>;
}

// @public
export class DatabaseTaskStore implements TaskStore {
  // (undocumented)
  cancelTask(
    options: TaskStoreEmitOptions<
      {
        message: string;
      } & JsonObject
    >,
  ): Promise<void>;
  // (undocumented)
  claimTask(): Promise<SerializedTask_2 | undefined>;
  // (undocumented)
  cleanWorkspace({ taskId }: { taskId: string }): Promise<void>;
  // (undocumented)
  completeTask(options: {
    taskId: string;
    status: TaskStatus_2;
    eventBody: JsonObject;
  }): Promise<void>;
  // (undocumented)
  static create(options: DatabaseTaskStoreOptions): Promise<DatabaseTaskStore>;
  // (undocumented)
  createTask(
    options: TaskStoreCreateTaskOptions,
  ): Promise<TaskStoreCreateTaskResult>;
  // (undocumented)
  emitLogEvent(
    options: TaskStoreEmitOptions<
      {
        message: string;
      } & JsonObject
    >,
  ): Promise<void>;
  // (undocumented)
  getTask(taskId: string): Promise<SerializedTask_2>;
  // (undocumented)
  getTaskState({ taskId }: { taskId: string }): Promise<
    | {
        state: JsonObject;
      }
    | undefined
  >;
  // (undocumented)
  heartbeatTask(taskId: string): Promise<void>;
  // (undocumented)
  list(options: {
    createdBy?: string;
    status?: TaskStatus_2;
    filters?: {
      createdBy?: string | string[];
      status?: TaskStatus_2 | TaskStatus_2[];
    };
    pagination?: {
      limit?: number;
      offset?: number;
    };
    order?: {
      order: 'asc' | 'desc';
      field: string;
    }[];
  }): Promise<{
    tasks: SerializedTask_2[];
    totalTasks?: number;
  }>;
  // (undocumented)
  listEvents(options: TaskStoreListEventsOptions): Promise<{
    events: SerializedTaskEvent_2[];
  }>;
  // (undocumented)
  listStaleTasks(options: { timeoutS: number }): Promise<{
    tasks: {
      taskId: string;
      recovery?: TaskRecovery;
    }[];
  }>;
  // (undocumented)
  recoverTasks(options: TaskStoreRecoverTaskOptions): Promise<{
    ids: string[];
  }>;
  // (undocumented)
  rehydrateWorkspace(options: {
    taskId: string;
    targetPath: string;
  }): Promise<void>;
  // (undocumented)
  retryTask?(options: { secrets?: TaskSecrets; taskId: string }): Promise<void>;
  // (undocumented)
  saveTaskState(options: { taskId: string; state?: JsonObject }): Promise<void>;
  // (undocumented)
  serializeWorkspace(options: { path: string; taskId: string }): Promise<void>;
  // (undocumented)
  shutdownTask(options: TaskStoreShutDownTaskOptions): Promise<void>;
}

// @public
export type DatabaseTaskStoreOptions = {
  database: DatabaseService | Knex;
  events?: EventsService;
};

// @public
const scaffolderPlugin: BackendFeature;
export default scaffolderPlugin;

// @public @deprecated
export type SerializedTask = SerializedTask_2;

// @public @deprecated
export type SerializedTaskEvent = SerializedTaskEvent_2;

// @public @deprecated
export type TaskBroker = TaskBroker_2;

// @public @deprecated
export type TaskBrokerDispatchOptions = TaskBrokerDispatchOptions_2;

// @public @deprecated
export type TaskBrokerDispatchResult = TaskBrokerDispatchResult_2;

// @public @deprecated
export type TaskCompletionState = TaskCompletionState_2;

// @public @deprecated
export type TaskContext = TaskContext_2;

// @public @deprecated
export type TaskEventType = TaskEventType_2;

// @public
export class TaskManager implements TaskContext_2 {
  // (undocumented)
  get cancelSignal(): AbortSignal;
  // (undocumented)
  cleanWorkspace?(): Promise<void>;
  // (undocumented)
  complete(result: TaskCompletionState_2, metadata?: JsonObject): Promise<void>;
  // (undocumented)
  static create(
    task: CurrentClaimedTask,
    storage: TaskStore,
    abortSignal: AbortSignal,
    logger: Logger,
    auth?: AuthService,
    config?: Config,
    additionalWorkspaceProviders?: Record<string, WorkspaceProvider>,
  ): TaskManager;
  // (undocumented)
  get createdBy(): string | undefined;
  // (undocumented)
  get done(): boolean;
  // (undocumented)
  emitLog(message: string, logMetadata?: JsonObject): Promise<void>;
  // (undocumented)
  getInitiatorCredentials(): Promise<BackstageCredentials>;
  // (undocumented)
  getTaskState?(): Promise<
    | {
        state?: JsonObject;
      }
    | undefined
  >;
  // (undocumented)
  getWorkspaceName(): Promise<string>;
  // (undocumented)
  rehydrateWorkspace?(options: {
    taskId: string;
    targetPath: string;
  }): Promise<void>;
  // (undocumented)
  get secrets(): TaskSecrets | undefined;
  // (undocumented)
  serializeWorkspace?(options: { path: string }): Promise<void>;
  // (undocumented)
  get spec(): TaskSpecV1beta3;
  // (undocumented)
  updateCheckpoint?(
    options:
      | {
          key: string;
          status: 'success';
          value: JsonValue;
        }
      | {
          key: string;
          status: 'failed';
          reason: string;
        },
  ): Promise<void>;
}

// @public @deprecated
export type TaskStatus = TaskStatus_2;

// @public
export interface TaskStore {
  // (undocumented)
  cancelTask?(options: TaskStoreEmitOptions): Promise<void>;
  // (undocumented)
  claimTask(): Promise<SerializedTask | undefined>;
  // (undocumented)
  cleanWorkspace?({ taskId }: { taskId: string }): Promise<void>;
  // (undocumented)
  completeTask(options: {
    taskId: string;
    status: TaskStatus;
    eventBody: JsonObject;
  }): Promise<void>;
  // (undocumented)
  createTask(
    options: TaskStoreCreateTaskOptions,
  ): Promise<TaskStoreCreateTaskResult>;
  // (undocumented)
  emitLogEvent(options: TaskStoreEmitOptions): Promise<void>;
  // (undocumented)
  getTask(taskId: string): Promise<SerializedTask>;
  // (undocumented)
  getTaskState?({ taskId }: { taskId: string }): Promise<
    | {
        state: JsonObject;
      }
    | undefined
  >;
  // (undocumented)
  heartbeatTask(taskId: string): Promise<void>;
  // (undocumented)
  list?(options: {
    filters?: {
      createdBy?: string | string[];
      status?: TaskStatus | TaskStatus[];
    };
    pagination?: {
      limit?: number;
      offset?: number;
    };
    order?: {
      order: 'asc' | 'desc';
      field: string;
    }[];
  }): Promise<{
    tasks: SerializedTask[];
    totalTasks?: number;
  }>;
  // @deprecated (undocumented)
  list?(options: {
    createdBy?: string;
    status?: TaskStatus;
    filters?: {
      createdBy?: string | string[];
      status?: TaskStatus | TaskStatus[];
    };
    pagination?: {
      limit?: number;
      offset?: number;
    };
    order?: {
      order: 'asc' | 'desc';
      field: string;
    }[];
  }): Promise<{
    tasks: SerializedTask[];
    totalTasks?: number;
  }>;
  // (undocumented)
  listEvents(options: TaskStoreListEventsOptions): Promise<{
    events: SerializedTaskEvent[];
  }>;
  // (undocumented)
  listStaleTasks(options: { timeoutS: number }): Promise<{
    tasks: {
      taskId: string;
    }[];
  }>;
  // (undocumented)
  recoverTasks?(options: TaskStoreRecoverTaskOptions): Promise<{
    ids: string[];
  }>;
  // (undocumented)
  rehydrateWorkspace?(options: {
    taskId: string;
    targetPath: string;
  }): Promise<void>;
  // (undocumented)
  retryTask?(options: { secrets?: TaskSecrets; taskId: string }): Promise<void>;
  // (undocumented)
  saveTaskState?(options: {
    taskId: string;
    state?: JsonObject;
  }): Promise<void>;
  // (undocumented)
  serializeWorkspace?({
    path,
    taskId,
  }: {
    path: string;
    taskId: string;
  }): Promise<void>;
  // (undocumented)
  shutdownTask?(options: TaskStoreShutDownTaskOptions): Promise<void>;
}

// @public
export type TaskStoreCreateTaskOptions = {
  spec: TaskSpec;
  createdBy?: string;
  secrets?: TaskSecrets;
};

// @public
export type TaskStoreCreateTaskResult = {
  taskId: string;
};

// @public
export type TaskStoreEmitOptions<TBody = JsonObject> = {
  taskId: string;
  body: TBody;
};

// @public
export type TaskStoreListEventsOptions = {
  isTaskRecoverable?: boolean;
  taskId: string;
  after?: number | undefined;
};

// @public
export type TaskStoreRecoverTaskOptions = {
  timeout: HumanDuration;
};

// @public
export type TaskStoreShutDownTaskOptions = {
  taskId: string;
};

// @public
export class TaskWorker {
  // (undocumented)
  static create(options: CreateWorkerOptions): Promise<TaskWorker>;
  // (undocumented)
  protected onReadyToClaimTask(): Promise<void>;
  // (undocumented)
  recoverTasks(): Promise<void>;
  // (undocumented)
  runOneTask(task: TaskContext_2): Promise<void>;
  // (undocumented)
  start(): void;
  // (undocumented)
  stop(): Promise<void>;
}

// @public
export class TemplateActionRegistry {
  // (undocumented)
  get(actionId: string): TemplateAction<any, any, any>;
  // (undocumented)
  list(): TemplateAction<any, any, any>[];
  // (undocumented)
  register(action: TemplateAction<any, any, any>): void;
}

// @public @deprecated (undocumented)
export type TemplateFilter = TemplateFilter_2;

// @public @deprecated (undocumented)
export type TemplateGlobal = TemplateGlobal_2;

// @public (undocumented)
export type TemplatePermissionRuleInput<
  TParams extends PermissionRuleParams = PermissionRuleParams,
> = PermissionRule<
  TemplateEntityStepV1beta3 | TemplateParametersV1beta3,
  {},
  typeof RESOURCE_TYPE_SCAFFOLDER_TEMPLATE,
  TParams
>;
```
